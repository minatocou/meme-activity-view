define(function(){function a(a,e,n){e=$(e);var t=e.find(a);return t.length>1&&("string"==typeof n.selector&&(t=e.find(n.selector+" "+a)),t.length>1&&(t=e.find("."+r.params.viewMainClass+" "+a))),1===t.length?t:void 0}function e(a,e,n){"to-left"===n&&(a.removeClass("page-on-center").addClass("page-from-center-to-left"),e.addClass("page-from-right-to-center")),"to-right"===n&&(a.removeClass("page-on-left").addClass("page-from-left-to-center"),e.removeClass("page-on-center").addClass("page-from-center-to-right"))}function n(a,e,n){"to-left"===n&&(e.removeClass("navbar-on-right").addClass("navbar-from-right-to-center"),e.find(".sliding").each(function(){var a=$(this);a.transform("translate3d(0px,0,0)"),r.params.animateNavBackIcon&&a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d(0px,0,0)")}),a.removeClass("navbar-on-center").addClass("navbar-from-center-to-left"),a.find(".sliding").each(function(){var a=$(this);r.params.animateNavBackIcon&&(a.hasClass("center")&&e.find(".sliding.left .back .icon").length>0&&(this.f7NavbarLeftOffset+=e.find(".sliding.left .back span")[0].offsetLeft),a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d("+-this.f7NavbarLeftOffset+"px,0,0)")),a.transform("translate3d("+this.f7NavbarLeftOffset+"px,0,0)")})),"to-right"===n&&(a.removeClass("navbar-on-left").addClass("navbar-from-left-to-center"),a.find(".sliding").each(function(){var a=$(this);a.transform("translate3d(0px,0,0)"),r.params.animateNavBackIcon&&a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d(0px,0,0)")}),e.removeClass("navbar-on-center").addClass("navbar-from-center-to-right"),e.find(".sliding").each(function(){var a=$(this);r.params.animateNavBackIcon&&a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d("+-this.f7NavbarRightOffset+"px,0,0)"),a.transform("translate3d("+this.f7NavbarRightOffset+"px,0,0)")}))}function t(t,o,i){var s,l,f,c,d,g,h,p,m=$(t.container);if(r.params.preprocess&&(i=r.params.preprocess(i,o)),r._tempDomElement.innerHTML="",o||"string"==typeof i)r._tempDomElement.innerHTML=i;else if("length"in i&&i.length>1)for(var v=0;v<i.length;v++)$(r._tempDomElement).append(i[v]);else $(r._tempDomElement).append(i);if(t.params.subEvents&&$(r._tempDomElement).find(".page").each(function(){var a=this;$(a).find("iframe").on("load",function(){t.attachSubEvents(a,this.contentWindow.document)})}),s=a(".page",r._tempDomElement,t),!s)return void(r.allowPageChange=!0);if(s.addClass("page-on-right"),f=m.find(".page:not(.cached)"),f.length>1){for(c=0;c<f.length-2;c++)t.params.domCache?$(f[c]).addClass("cached"):$(f[c]).remove();t.params.domCache?$(f[c]).addClass("cached"):$(f[c]).remove()}if(l=m.find(".page:not(.cached)"),t.params.dynamicNavbar&&(p=!0,g=a(".navbar-inner",r._tempDomElement,t),g||(p=!1),h=m.find(".navbar"),d=h.find(".navbar-inner:not(.cached)"),d.length>0)){for(c=0;c<d.length-1;c++)t.params.domCache?$(d[c]).addClass("cached"):$(d[c]).remove();g||1!==d.length||(t.params.domCache?$(d[0]).addClass("cached"):$(d[0]).remove()),d=h.find(".navbar-inner:not(.cached)")}p&&(g.addClass("navbar-on-right"),h.append(g[0])),o||(o="#content-"+t.history.length,t.params.domCache||(1===t.history.length&&(t.contentCache[t.history[0]]={nav:d,page:l}),t.contentCache[o]={nav:g,page:s})),t.url=o,t.history.push(o),$(t.pagesContainer).append(s[0]),r.pageInitCallback(t,s[0],o,"right"),p&&g.find(".sliding").each(function(){var a=$(this);a.transform("translate3d("+this.f7NavbarRightOffset+"px,0,0)"),r.params.animateNavBackIcon&&a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d("+-this.f7NavbarRightOffset+"px,0,0)")});s[0].clientLeft;r.pageAnimCallbacks("before",t,{pageContainer:s[0],url:o,position:"left",oldPage:l,newPage:s}),e(l,s,"to-left",t),p&&setTimeout(function(){n(d,g,"to-left",t)},0),s.animationEnd(function(){r.allowPageChange=!0,s.removeClass("page-from-right-to-center page-on-right").addClass("page-on-center"),l.removeClass("page-from-center-to-left").addClass("page-on-left"),p&&(g.removeClass("navbar-from-right-to-center").addClass("navbar-on-center"),d.removeClass("navbar-from-center-to-left").addClass("navbar-on-left")),r.pageAnimCallbacks("after",t,{pageContainer:s[0],url:o,position:"right",oldPage:l,newPage:s}),r.params.pushState&&r.pushStateClearQueue()})}var r={};r.pageInitCallback=function(a,e,n,t){if(!e.initialized){e.initialized=!0;var o={container:e,url:n,query:$.parseUrlQuery(n||""),name:$(e).attr("data-page"),view:a,from:t};$(o.container).trigger("pageBeforeInit",{page:o}),r.initPage(e),$(o.container).trigger("pageInit",{page:o})}},r.pageAnimCallbacks=function(a,e,n){var t={container:n.pageContainer,url:n.url,query:$.parseUrlQuery(n.url||""),name:$(n.pageContainer).attr("data-page"),view:e,from:n.position},r=n.oldPage,o=n.newPage;"after"===a&&$(t.container).trigger("pageAfterAnimation",{page:t}),"before"===a&&($(e.container).attr("data-page",t.name),o.hasClass("no-navbar")&&!r.hasClass("no-navbar")&&e.hideNavbar(),!o.hasClass("no-navbar")&&r.hasClass("no-navbar")&&e.showNavbar(),o.hasClass("no-toolbar")&&!r.hasClass("no-toolbar")&&e.hideToolbar(),!o.hasClass("no-toolbar")&&r.hasClass("no-toolbar")&&e.showToolbar(),$(t.container).trigger("pageBeforeAnimation",{page:t}))},r.initPage=function(a){r.sizeNavbars&&r.sizeNavbars($(a).parents("."+r.params.viewClass)[0]),r.initMessages&&r.initMessages(a),r.initFormsStorage&&r.initFormsStorage(a),r.initSmartSelects&&r.initSmartSelects(a)},r.allowPageChange=!0,r._tempDomElement=document.createElement("div"),r.loadContent=function(a,e,n){return r.allowPageChange?(r.allowPageChange=!1,r.xhr&&(r.xhr.abort(),r.xhr=!1),r.params.pushState&&("undefined"==typeof n&&(n=!0),n&&history.pushState({content:e,url:"#content-"+a.history.length},"","#/#content-"+a.history.length)),void t(a,null,e)):!1},r.loadPage=function(a,e,n){return r.allowPageChange?a.url===e?!1:(r.allowPageChange=!1,r.xhr&&(r.xhr.abort(),r.xhr=!1),void r.get(e,function(o,i){return i?void(r.allowPageChange=!0):(r.params.pushState&&("undefined"==typeof n&&(n=!0),n&&history.pushState({url:e},"","#/"+e)),void t(a,e,o))})):!1},r.goBack=function(t,o,i,s){function l(){r.pageAnimCallbacks("before",t,{pageContainer:d[0],url:o,position:"left",oldPage:c,newPage:d}),e(d,c,"to-right",t),m&&setTimeout(function(){n(h,g,"to-right",t)},0),d.animationEnd(function(){r.afterGoBack(t,c[0],d[0]),r.pageAnimCallbacks("after",t,{pageContainer:d[0],url:o,position:"left",oldPage:c,newPage:d})})}function f(){if(d=a(".page",r._tempDomElement,t),!d)return void(r.allowPageChange=!0);if(d.addClass("page-on-left"),c=$(v.find(".page")[0]),t.params.dynamicNavbar&&(m=!0,h=a(".navbar-inner",r._tempDomElement,t),h||(m=!1)),m&&(p=v.find(".navbar"),g=p.find(".navbar-inner"),h.addClass(g.length>0?"navbar-on-left":"navbar-on-center"),g.length>1&&($(g[0]).remove(),g=p.find(".navbar-inner")),p.prepend(h[0])),$(t.pagesContainer).prepend(d[0]),r.pageInitCallback(t,d[0],o,"left"),m&&h.hasClass("navbar-on-left")&&h.find(".sliding").each(function(){var a=$(this);r.params.animateNavBackIcon&&(a.hasClass("left")&&a.find(".back .icon").length>0&&a.find(".back .icon").transform("translate3d("+-this.f7NavbarLeftOffset+"px,0,0)"),a.hasClass("center")&&g.find(".left .back .icon").length>0&&(this.f7NavbarLeftOffset+=g.find(".left .back span")[0].offsetLeft)),a.transform("translate3d("+this.f7NavbarLeftOffset+"px,0,0)")}),i)return d.addClass("page-on-left"),void(r.allowPageChange=!0);t.url=o;d[0].clientLeft;l()}if(!r.allowPageChange)return!1;r.allowPageChange=!1,r.xhr&&(r.xhr.abort(),r.xhr=!1),r.params.pushState&&("undefined"==typeof s&&(s=!0),!i&&history.state&&s&&history.back());var c,d,g,h,p,m,v=$(t.container),C=v.find(".page");if(C.length>1){if(i)return void(r.allowPageChange=!0);if(t.url=t.history[t.history.length-2],d=$(C[C.length-2]),c=$(C[C.length-1]),t.params.dynamicNavbar){m=!0;var b=v.find(".navbar-inner:not(.cached)");h=$(b[0]),g=$(b[1])}l()}else{if(o&&0===o.indexOf("#")&&(o=void 0),t.history.length>1&&(o=t.history[t.history.length-2]),!o)return void(r.allowPageChange=!0);if(!t.params.domCache&&o in t.contentCache){var u=t.contentCache[o];return r._tempDomElement.innerHTML="",$(r._tempDomElement).append(u.nav[0]).append(u.page[0]),void f()}r.get(o,function(a,e){return e?void(r.allowPageChange=!0):(r.params.preprocess&&(a=r.params.preprocess(a,o)),r._tempDomElement.innerHTML=a,void f())})}},r.afterGoBack=function(a,e,n){if(e=$(e),n=$(n),e.remove(),n.removeClass("page-from-left-to-center page-on-left").addClass("page-on-center"),r.allowPageChange=!0,a.params.dynamicNavbar){{var t=$(a.container).find(".navbar-inner:not(.cached)");$(t[1]).remove(),$(t[0]).removeClass("navbar-on-left navbar-from-left-to-center").addClass("navbar-on-center")}if(r.params.preloadPreviousPage&&a.params.domCache){var o=$(a.container).find(".navbar-inner.cached");$(o[o.length-1]).removeClass("cached")}}if(a.history.pop(),!a.params.domCache&&a.url&&a.url.indexOf("#content-")>-1&&a.url in a.contentCache&&(a.contentCache[a.url]=null,delete a.contentCache[a.url]),r.params.pushState&&r.pushStateClearQueue(),r.params.preloadPreviousPage){if(a.params.domCache){var i=$(a.container).find(".page.cached");$(i[i.length-1]).removeClass("cached")}r.goBack(a,!1,!0)}}});