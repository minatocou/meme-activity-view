define(function(t){function i(t){if(o.call(this,t),this.main){var i=this.main;this.index=parseInt(this.startSlide,10)||0;var e=this;return this.events={handleEvent:function(i){switch(i.type){case"touchstart":r.getUI(i.srcElement)._start(i);break;case"touchmove":r.getUI(i.srcElement)._move(i);break;case"touchend":a(r.getUI(i.srcElement)._end(i));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":a(this.transitionEnd(i));break;case"resize":a(e._setup.call())}t.stopPropagation&&i.stopPropagation()},transitionEnd:function(i){parseInt(i.target.getAttribute("data-index"),10)==e.index&&(e.auto&&e.begin(),"function"==typeof t.transitionEnd&&t.transitionEnd.call(i,e.index,e.slides[e.index]))}},this._setup(),this.auto&&this.begin(),d.addEventListener&&(d.touch&&i.addEventListener("touchstart",this.events,!1),d.transitions&&(i.addEventListener("webkitTransitionEnd",this.events,!1),i.addEventListener("msTransitionEnd",this.events,!1),i.addEventListener("oTransitionEnd",this.events,!1),i.addEventListener("otransitionend",this.events,!1),i.addEventListener("transitionend",this.events,!1)),window.addEventListener("resize",this.events,!1)),this}}var e,s,n,h=t("../common/lib"),o=t("./WebControl"),r=t("./blend"),a=h.offloadFn,d={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var i=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var e in i)if(void 0!==t.style[i[e]])return!0;return!1}(document.createElement("swipe"))},l={},v={};return h.inherits(i,o),i.prototype.auto=0,i.prototype.speed=300,i.prototype.continuous=!0,i.prototype.slides=null,i.prototype.width=0,i.prototype._translate=function(t,i,e){var s=this.slides[t],n=s&&s.style;n&&(n.webkitTransitionDuration=n.MozTransitionDuration=n.msTransitionDuration=n.OTransitionDuration=n.transitionDuration=e+"ms",n.webkitTransform="translate("+i+"px,0)translateZ(0)",n.msTransform=n.MozTransform=n.OTransform="translateX("+i+"px)")},i.prototype._setup=function(){var t=this.main.children[0];this.slides=this.main.children[0].children,s=new Array(this.slides.length),this.width=this.main.getBoundingClientRect().width||this.main.offsetWidth,t.style.width=this.slides.length*this.width+"px";for(var i=this.slides.length;i--;){var e=this.slides[i];e.style.width=this.width+"px",e.setAttribute("data-index",i),d.transitions&&(e.style.left=i*-this.width+"px",this.__move(i,this.index>i?-this.width:this.index<i?this.width:0,0))}d.transitions||(element.style.left=this.index*-this.width+"px"),t.style.visibility="visible"},i.prototype._slide=function(t,i){if(this.index!=t){if(d.transitions){for(var e=Math.abs(this.index-t)-1,s=Math.abs(this.index-t)/(this.index-t);e--;)this.__move((t>this.index?t:this.index)-e-1,this.width*s,0);this.__move(this.index,this.width*s,i||this.speed),this.__move(t,0,i||this.speed)}return this.index=t,a(this.callback&&this.callback(this.index,this.slides[this.index])),this}},i.prototype.__move=function(t,i,e){this._translate(t,i,e),s[t]=i},i.prototype._start=function(t){var i=t.touches[0];l={x:i.pageX,y:i.pageY,time:+new Date},n=void 0,v={},this.main.addEventListener("touchmove",this.events,!1),this.main.addEventListener("touchend",this.events,!1)},i.prototype._move=function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){this.disableScroll&&t.preventDefault();var i=t.touches[0];v={x:i.pageX-l.x,y:i.pageY-l.y},"undefined"==typeof n&&(n=!!(n||Math.abs(v.x)<Math.abs(v.y))),n||(t.preventDefault(),this.stop(),v.x=v.x/(!this.index&&v.x>0||this.index==this.slides.length-1&&v.x<0?Math.abs(v.x)/this.width+1:1),this._translate(this.index-1,v.x+s[this.index-1],0),this._translate(this.index,v.x+s[this.index],0),this._translate(this.index+1,v.x+s[this.index+1],0))}},i.prototype._end=function(){var t=+new Date-l.time,i=Number(t)<250&&Math.abs(v.x)>20||Math.abs(v.x)>this.width/2,e=!this.index&&v.x>0||this.index==this.slides.length-1&&v.x<0,h=v.x<0;n||(i&&!e?(h?(this.__move(this.index-1,-this.width,0),this.__move(this.index,s[this.index]-this.width,this.speed),this.__move(this.index+1,s[this.index+1]-this.width,this.speed),this.index+=1):(this.__move(this.index+1,this.width,0),this.__move(this.index,s[this.index]+this.width,this.speed),this.__move(this.index-1,s[this.index-1]+this.width,this.speed),this.index+=-1),"function"==typeof this.callback&&this.callback(this.index,this.slides[this.index])):(this.__move(this.index-1,-this.width,this.speed),this.__move(this.index,0,this.speed),this.__move(this.index+1,this.width,this.speed))),this.main.removeEventListener("touchmove",this.events,!1),this.main.removeEventListener("touchend",this.events,!1)},i.prototype.dispose=function(){o.prototype.dispose();var t=this.main;this.stop(),t.style.width="auto",t.style.left=0;for(var i=this.slides.length;i--;){var e=this.slides[i];e.style.width="100%",e.style.left=0,d.transitions&&this._translate(i,0,0)}d.addEventListener&&(t.removeEventListener("touchstart",this.events,!1),t.removeEventListener("webkitTransitionEnd",this.events,!1),t.removeEventListener("msTransitionEnd",this.events,!1),t.removeEventListener("oTransitionEnd",this.events,!1),t.removeEventListener("otransitionend",this.events,!1),t.removeEventListener("transitionend",this.events,!1),window.removeEventListener("resize",this.events,!1))},i.prototype.prev=function(){return this.index?this._slide(this.index-1):this.continuous&&this._slide(this.slides.length-1),this},i.prototype.next=function(){return this.index<this.slides.length-1?this._slide(this.index+1):this.continuous&&this._slide(0),this},i.prototype.begin=function(){var t=this;e&&clearTimeout(e),e=setTimeout(function(){t.next()},this.auto)},i.prototype.stop=function(){clearTimeout(e)},i});