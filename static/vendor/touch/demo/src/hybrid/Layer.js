define(function(t){var r=t("./blend"),e=t("../common/lib"),n=t("./runtime"),o=t("./Control"),i=!0,l=n.layer;l.on("in",function(t){var e=r.get(t.data);e&&e.onhide&&e.onshow()}),l.on("out",function(t){var e=r.get(t.data);e&&e.onhide&&e.onhide()});var a=function(t){return o.call(this,t),this._init(t),this};return e.inherits(a,o),a.prototype.constructor=a,a.prototype._init=function(t){return this._initEvent(),this.render(),t.active&&this.in(),this},a.prototype.type="layer",a.prototype.loadingTime=500,a.prototype._initEvent=function(){var t=this,r=null;return t.ptrFn&&l.on("layerPullDown",function(){t.ptrFn.apply(t,arguments)},t.id,t),l.on("layerCreateSuccess",function(){r=setTimeout(function(){l.layerStopLoading(t.id)},t.loadingTime),t.afterrender&&t.afterrender.apply(t,arguments)},t.id,t),l.on("layerLoadFinish",function(e){clearTimeout(r),e.url!==t.url&&(t.url=e.url,t.changeUrl&&t.changeUrl.call(t,e,t.url)),t.onload&&t.onload.apply(t,arguments)},t.id,t),t.on("afterdestory",function(){clearTimeout(r),t.ptrFn&&l.off("layerPullDown","all",t.id,t),l.off("layerCreateSuccess","all",t.id,t),l.off("layerLoadFinish","all",t.id,t)}),t},a.prototype.paint=function(){var t=this;return i&&l.prepare(t.id,{url:t.url,top:t.top,left:t.left,bottom:t.bottom,right:t.right,pullToRefresh:t.pullToRefresh}),this},a.prototype.in=function(){var t=this;return l.isAvailable(this.id)||t.render(),l.resume(t.id,{reverse:t.reverse,fx:t.fx,duration:t.duration,timingFn:t.timingFn}),this},a.prototype.out=function(){return l.back(),this},a.prototype.reload=function(t){return t||(t=this.url),l.reload(this.id,t),this},a.prototype.stopPullRefresh=function(){return l.stopPullRefresh(this.id),this},a.prototype.destroy=function(){o.prototype.destroy.apply(this,arguments)},a});