define(function(t){var o=(t("./blend"),t("./lib")),e=t("./Control"),n=function(t){return console.log("dialog init"),e.call(this,t),this._init(),this};return o.inherits(n,e),n.prototype.type="dialog",n.prototype.content="",n.prototype.title="",n.prototype.afterContent="",n.prototype._init=function(){var t=this,o="";if(this.buttons&&this.buttons.length>0)for(var e=0;e<this.buttons.length;e++)o+='<span class="modal-button'+(this.buttons[e].bold?" modal-button-bold":"")+'">'+this.buttons[e].text+"</span>";var n='<div class="modal {{noButtons}}"><div class="modal-inner">{{if title}}<div class="modal-title">{{title}}</div>{{/if title}}<div class="modal-text">{{content}}</div>{{afterContent}}</div><div class="modal-buttons">{{buttons}}</div></div>';n=this.title?n.replace(/{{if\ title}}/g,"").replace(/{{\/if\ title}}/g,""):n.split("{{if title}}")[0]+n.split("{{/if title}}")[1];var i=n.replace(/{{title}}/g,this.title).replace(/{{content}}/g,this.content).replace(/{{afterContent}}/g,this.afterContent).replace(/{{buttons}}/g,o).replace(/{{noButtons}}/g,this.buttons&&0!==this.buttons.length?"":"modal-no-buttons");return this.main.innerHTML=i,$("body").append(this.main),$(this.main).find(".modal-button").each(function(o,e){$(e).on("click",_.bind(function(t){this.buttons[o].close!==!1&&this.close(),this.buttons[o].onclick&&this.buttons[o].onclick.call(this,t)},t))}),this.open(),this},n.prototype.open=function(){n.__open($(this.main).children())},n.__open=function(t){var t=$(t);if(0===$(".modal-overlay").length){var o=document.createElement("div");o.className="modal-overlay",$("body").append(o)}var e=t.hasClass("popover"),n=t.hasClass("popup");e||n||t.css({marginTop:-t.outerHeight()/2+"px"});t[0].clientLeft;return t.trigger("open"),$(".modal-overlay").addClass("modal-overlay-visible"),t.removeClass("modal-out").addClass("modal-in").transitionEnd(function(){t.trigger(t.hasClass("modal-out")?"closed":"opened")}),!0},n.prototype.close=function(){return n.__close($(this.main).children())},n.__close=function(t){var t=$(t)||".modal-in";$(".modal-overlay").removeClass("modal-overlay-visible"),t.trigger("close");var o=t.hasClass("popup"),e=t.hasClass("remove-on-close");return t.hasClass("popover")?(t.removeClass("modal-in modal-out").trigger("closed").hide(),e&&t.remove()):t.removeClass("modal-in").addClass("modal-out").transitionEnd(function(){t.trigger(t.hasClass("modal-out")?"closed":"opened"),o||t.remove(),o&&t.removeClass("modal-out").hide(),e&&t.remove()}),!0},n});