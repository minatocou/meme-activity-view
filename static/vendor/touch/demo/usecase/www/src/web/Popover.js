define(function(o){var t=(o("./blend"),o("./lib")),e=o("./Dialog"),s=o("./Control"),i=function(o,t,e){if(s.call(this,{modal:o,target:t,removeOnClose:e}),"string"==typeof this.modal&&this.modal.indexOf("<")>=0){var i=document.createElement("div");if(i.innerHTML=this.modal,!(i.childNodes.length>0))return!1;o=i.childNodes[0],this.removeOnClose&&this.modal.classList.add("remove-on-close"),$("body").append(this.modal)}return o=$(o),t=$(t),0===o.length||0===t.length?!1:($(this.main).append(o).appendTo("body"),0===o.find(".popover-angle").length&&o.append('<div class="popover-angle"></div>'),o.show(),this._resizeHandler(),$(window).on("resize",_.bind(this._resizeHandler,this)),o.on("close",function(){$(window).off("resize",_.bind(this._resizeHandler,this))}),this.open(),this)};return t.inherits(i,e),i.prototype.removeOnClose=!0,i.prototype.type="popover",i.prototype._resizeHandler=function(){var o=$(this.modal),t=$(this.target);o.css({left:"",top:""});var e=o.width(),s=o.height(),i=o.find(".popover-angle"),n=i.width()/2;i.removeClass("on-left on-right on-top on-bottom").css({left:"",top:""});var l=t.outerWidth(),d=t.outerHeight(),r=t.offset(),a=t.parents(".page");a.length>0&&(r.top=r.top-a[0].scrollTop);var p=$(window).height(),h=$(window).width(),f=0,m=0,g=0,v="top";s+n<r.top?f=r.top-s-n:s+n<p-r.top-d?(v="bottom",f=r.top+d+n):(v="middle",f=d/2+r.top-s/2,g=f,0>f?f=5:f+s>p&&(f=p-s-5),g-=f),"top"===v||"bottom"===v?(m=l/2+r.left-e/2,g=m,5>m&&(m=5),m+e>h&&(m=h-e-5),"top"===v&&i.addClass("on-bottom"),"bottom"===v&&i.addClass("on-top"),g-=m,i.css({left:e/2-n+g+"px"})):"middle"===v&&(m=r.left-e-n,i.addClass("on-right"),5>m&&(m=r.left+l+n,i.removeClass("on-right").addClass("on-left")),m+e>h&&(m=h-e-5,i.removeClass("on-right").addClass("on-left")),i.css({top:s/2-n+g+"px"})),o.css({top:f+"px",left:m+"px"})},i});