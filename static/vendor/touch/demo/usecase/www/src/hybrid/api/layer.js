define(function(){var e={},r=(window.devicePixelRatio||2,"0");e.prepare=function(e,r){var e=e||uniqid(),n={};return["url","pullToRefresh","reverse","fx","duration","timingFn"].forEach(function(e){void 0!==r[e]&&(n[e]=r[e])}),window.lc_bridge.prepareLayer(e,JSON.stringify(n)),e},e.resume=function(r,n){var t={fx:"slide",reverse:!1,duration:"normal"};n&&(n.fx&&(t.fx=n.fx),n.reverse&&(t.reverse=n.reverse),n.duration&&(t.duration=n.duration)),window.lc_bridge.resumeLayer(r,JSON.stringify(t)),e.fire("in",!1,r)},e.back=function(r){window.lc_bridge.backToPreviousLayer(),e.fire("out",!1,r||e.getCurrentId())},e.reload=function(r,n){return(1==arguments.length||0==arguments.length)&&(n=r,r=e.getCurrentId()),window.lc_bridge.layerLoadUrl(r,n),r},e.destroy=function(r){return r||(r=e.getCurrentId()),window.lc_bridge.destroyLayer(r),r},e.stopPullRefresh=function(r){return r||(r=e.getCurrentId()),window.lc_bridge.layerStopRefresh(r),r},e.isAvailable=function(e){return window.lc_bridge.isLayerAvailable(e)},e.getCurrentId=function(){return window.lc_bridge.currentLayerId()},e.layerStopLoading=function(r){return r=r||e.getCurrentId(),window.lc_bridge.layerStopLoading(r)};var n={layerCreateSuccess:{listener:[],callback:function(e){for(var r=n.layerCreateSuccess.listener,t=0,l=r.length;l>t;t++)r[t].layerId==e.origin&&r[t].callback.call(r[t].context,e,r[t].layerId)}},layerLoadFinish:{listener:[],callback:function(e){for(var r=n.layerLoadFinish.listener,t=0,l=r.length;l>t;t++)r[t].layerId==e.origin&&r[t].callback.call(r[t].context,e,r[t].layerId)}},layerPullDown:{listener:[],callback:function(e){for(var r=n.layerPullDown.listener,t=0,l=r.length;l>t;t++)r[t].layerId==e.origin&&r[t].callback.call(r[t].context,e,r[t].layerId)}}};return e.on=function(r,t,l,i){if(l=l||e.getCurrentId(),i=i||e,n[r]){for(var a=0,o=n[r].listener,c=o.length;c>a&&(o[a].layerId!=l||o[a].callback!=t||o[a].context!=i);a++);a==c&&n[r].listener.push({layerId:l,context:i,callback:t}),n[r].listened||(document.addEventListener(r,n[r].callback,!1),n[r].listened=!0)}else n[r]={listener:[],callback:function(e){var t=JSON.parse(e.data),l=n[r].listener;e.origin=e.sender||t.origin,e.data=t.data,e.reciever=e.target=t.target;for(var i=0,a=l.length;a>i;i++)l[i].callback.call(l[i].context,e,l[i].layerId)}},e.on(r,t,l,i)},e.off=function(r,t,l,i){if(l=l||e.getCurrentId(),i=i||e,n[r])if(t){for(var a=0,o=n[r].listener,c="all"==t,d=o.length;d>a;a++)if(o[a].layerId==l&&o[a].context==i&&(c||o[a].callback==t)){o.splice&&o.splice(a,1);break}0==o.length&&n[r].listened&&(document.removeEventListener(r,n[r].callback),n[r].listened=!1)}else document.removeEventListener(r,n[r].callback),n[r].listened=!1,n[r].listener=[];else console.log("无此事件绑定")},e.fire=function(n,t,l){t?"top"==t&&(t=r):t="";var i=e.getCurrentId(),a={};a.data=l||"",a.target=t,a.origin=i,window.lc_bridge.layerPostMessage(i,t,n,JSON.stringify(a))},e.postMessage=function(r,n){e.fire("message",n,r)},e});