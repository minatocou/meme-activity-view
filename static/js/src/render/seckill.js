Vue.config.delimiters=["${","}"];var sec_kill=new Vue({el:"#seckill",data:{testData:null,groupList:null,show:!1,showList:!1,showTime:!1,tab:{date:[],time:[]},countdownFlag:"",secKillTime:"",durationInfo:"",IS_active:"",serverTime:"",activeTime:[],activeIndex:null,swiper:[],list:"",listHeight:"",ACTIVE_INDEX:[]},methods:{goDetail:function(t){var i={productId:t.productId,durationId:t.durationId,groupId:t.groupId,activityType:4,from:"h5list"};vue.isApp()?vue.app_product(i):location.href=$("body").data("pc")+"/m/productDetails/productDetails.html?from=h5list&p="+t.productId+"&groupId="+t.groupId+"&durationId="+t.durationId+"&activityType=4"},changeActive:function(){var t=this;return t.serverTime<t.durationInfo.secKillStartTime?2:t.durationInfo.secKillStartTime<t.serverTime&&t.serverTime<t.durationInfo.secKillEndTime?3:t.durationInfo.secKillEndTime<t.serverTime?1:void 0},getServerTime:function(){var t,i=this,e=["","end","no-start","start"],n=["","已结束","未开始","活动中"];i.showTime=!1,$.ajax({url:$("body").data("pc")+"/h5/seckill/getServiceTimeStamp",dataType:"json",success:function(a){if(1==a.code){i.serverTime=a.data.nowTimeStamp,clearInterval(i.countdownFlag);var o=["","",function(){i.countdown(i.durationInfo.secKillStartTime,i.serverTime,function(){Vue.set(i.durationInfo,"class","start"),Vue.set(i.tab.time[i.activeIndex[0]][i.activeIndex[1]],1,"活动中"),i.changeTime(i.activeIndex[1]),i.countdown(i.durationInfo.secKillEndTime,i.serverTime,function(){location.reload()})})},function(){i.countdown(i.durationInfo.secKillEndTime,i.serverTime,function(){location.reload()})}];Vue.set(i.durationInfo,"is_active",i.changeActive()),t=i.durationInfo.is_active,"function"==typeof o[t]&&o[t](),Vue.set(i.durationInfo,"class",e[t]),Vue.set(i.tab.time[i.activeIndex[0]][i.activeIndex[1]],1,n[t]),Vue.set(i.durationInfo,"class",e[t]),i.showTime=!0,$("#seckill .flash-list").css({height:"auto"}),i.listHeight=$("#seckill .flash-list").height()}}})},pageInit:function(){var t=this;$.ajax({url:$("body").data("pc")+"/h5/seckill/list",dataType:"json",success:function(i){1==i.code&&i.data&&i.data.groupList&&(t.groupList=i.data.groupList,t.formatList(t.groupList),t.activeTime=t.tab.time[t.activeIndex[0]],t.$nextTick(t.swiperInit),t.show=!0)},error:function(t){console.log(t)}})},changeTime:function(t){var i,e=this.groupList[this.activeIndex[0]].duration[t],n=this;this.activeIndex[1]=t,this.list=e.productList,this.changeDuration(e),this.activeTime=null,i=setTimeout(function(){n.activeTime=n.tab.time[n.activeIndex[0]],i=null},0)},changeDate:function(t){var i=this,e=this.groupList[t].duration[0];this.activeIndex[0]=t,this.activeIndex[1]=0,this.activeTime=i.tab.time[t],this.list=e.productList,this.changeDuration(e)},swiperInit:function(){var t=this;t.swiper[0]=new Swiper(".nav1",{slidesPerView:5,centeredSlides:!0,slideToClickedSlide:!0,initialSlide:t.activeIndex[0],onSlideChangeEnd:function(i){t.changeDate(i.activeIndex)}})},getStock:function(t){var i="",e=this;if(3!=e.IS_active)return!1;for(var n=0,a=t.length;a>n;n++)i+=","+t[n].productId;i=i.slice(1),$.ajax({url:$("body").data("pis")+"/global/price",dataType:"json",data:{productIds:i},success:function(i){for(var e=i.data,n=0,a=e.length;a>n;n++)t[n].seckillStock=1==e[n].stockStatus&&1==t[n].seckillStock?!0:!1}})},formatList:function(t){var i=0,e=t.length,n=this,a=["","已结束","未开始","活动中"],o=!1;for(i;e>i;i++){var r=t[i].duration.length;this.tab.date.push(n.getDate(t[i].date)),this.tab.time.push([]);for(var s=0;r>s;s++)this.tab.time[i].push([]),n.tab.time[i][s].push(n.getTime(t[i].duration[s].secKillStartTime)),3==t[i].duration[s].is_active&&(n.IS_active=3),(3==t[i].duration[s].is_active||2==t[i].duration[s].is_active&&null==n.activeIndex)&&(o=!0,n.activeIndex=[i,s],n.ACTIVE_INDEX[0]=i,n.ACTIVE_INDEX[1]=s,n.list=t[i].duration[s].productList,n.changeDuration(t[i].duration[s])),Vue.set(n.tab.time[i][s],1,a[t[i].duration[s].is_active])}o||(n.activeIndex=[0,0],n.ACTIVE_INDEX[0]=0,n.ACTIVE_INDEX[1]=0,n.list=t[0].duration[0].productList,n.changeDuration(t[0].duration[0])),n.getStock(n.list)},changeDuration:function(t){var i=this;this.durationInfo={},this.durationInfo.secKillEndTime=t.secKillEndTime,this.durationInfo.secKillStartTime=t.secKillStartTime,this.durationInfo.startTime=this.getTime(t.secKillStartTime),i.getServerTime()},getTime:function(t){var i=new Date(t),e=i.getHours(),n=i.getMinutes();return(10>e?"0"+e:e)+":"+(10>n?"0"+n:n)},getDate:function(t){var i=t.match(/-(.+)/)[1];return i.replace("-","月")},countdown:function(t,i,e){function n(t){o.countdownFlag=setInterval(function(){t>=0?(a(t),t--):(clearInterval(o.countdownFlag),"function"==typeof e&&e())},1e3)}function a(t){function i(t){return 10>t?"0"+t:t}var e=parseInt(t/60/60/24,10),n=parseInt(t/60/60%24,10),a=parseInt(t/60%60,10),r=parseInt(t%60,10);o.secKillTime=(0!=e?e+":":"")+i(n)+":"+i(a)+":"+i(r)}var o=this;return t=(t-i)/1e3,0>=t?!1:void n(t)}},ready:function(){(null==appVer.iosVer()&&null==appVer.androidVer()||appVer.iosVer()>=460||appVer.androidVer()>=460)&&this.pageInit()},created:function(){}});