var vue={wxConfig:null,appid:"wx0deda0920b9a3e80",openId:"",wxError:null,memeDomain:"https://cn.memebox.com",get_wxSdk:function(e){window.wx&&e()},app_product:function(e){e=e||{},e.url=location.href,window.callByJS&&window.callByJS({domain:"product",action:"detail",param:e})},isIos:function(){return/iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase())},isAndroid:function(){return/android/.test(window.navigator.userAgent.toLowerCase())},isApp:function(){return this.iosVer()||this.androidVer()||this.iosAlias()},iosVer:function(){var e=navigator.appVersion.match(/MWProjectTemplate.*/);return e&&e[0].match(/[\d]/g)&&e[0].match(/[\d]/g).join("")},iosAlias:function(){var e=navigator.appVersion.match(/MemeboxAlias.*/);return e&&e[0].match(/[\d]/g)&&e[0].match(/[\d]/g).join("")},androidVer:function(){var e=navigator.appVersion.match(/MeMeAndroid.*/);return e&&e[0].match(/[\d]/g)&&e[0].match(/[\d]/g).join("")},isInWeixin:function(){return/MicroMessenger/i.test(navigator.userAgent)},getSearch:function(e,a){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=a?a.substr(1).match(t):decodeURIComponent(window.location.search).substr(1).match(t);return null!=n?n[2]:null},getPlatform:function(){return this.isInWeixin()?"wechat":this.iosVer()?"iOS":this.androidVer()?"Android":"h5"},openNative:function(e){var a=this;if(a.isIos()){if(a.isApp())a.isWeixin()&&(location.href=location.origin+"/m/app?app_json="+encodeURIComponent(JSON.stringify(e)));else{var t=document.createElement("iframe");t.src="memebox://"+encodeURIComponent(JSON.stringify(e)),t.style.display="none",t.onload=function(){console.log("success")},document.body.appendChild(t)}location.href="memebox://"+encodeURIComponent(JSON.stringify(e))}if(a.isAndroid()){if(!a.isApp()){var t=document.createElement("iframe");t.src="memebox://"+encodeURIComponent(JSON.stringify(e)),t.style.display="none",t.onload=function(){console.log("success")},document.body.appendChild(t)}location.href="memebox://m.cn.memebox.com?app_json="+encodeURIComponent(JSON.stringify(e))}},toAppH5View:function(e,a,t){e=e||location.href,a=a||document.title,t=t||null;var n=this,i={domain:"h5page",action:"to_h5page",data:{url:e,title:a,image_url:t}};n.isApp()||n.openNative(i)},signature:function(e,a){var t=this,n={url:location.href};e&&(n.err=e),this.isInWeixin()&&(t.wxConfig?(wx.config(t.wxConfig),a&&a(n,e)):$.ajax({url:t.memeDomain+"/h5/wechat/getsignpackage",data:n,dataType:"json",showLoading:!0,success:function(n){t.wxConfig={debug:/debug=1/.test(location.search),appId:n.data.appId,timestamp:n.data.timestamp,timeStamp:n.data.timestamp,nonceStr:n.data.nonceStr,signature:n.data.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","chooseWXPay"]},wx.config(t.wxConfig),wx.error(function(e){t.wxError=e,/debug=1/.test(location.search)&&alert(JSON.stringify(e)),t.signature(e),t.signature=function(){}}),a&&a(n,e)}}))},addUrlPara:function(e,a,t){t=t||window.location.href;var n=t.split("#")[0];return/\?/g.test(n)?/name=[-\w]{4,25}/g.test(n)?n=n.replace(/name=[-\w]{4,25}/g,e+"="+a):n+="&"+e+"="+a:n+="?"+e+"="+a,t.split("#")[1]?n+"#"+t.split("#")[1]:n},native_share:function(e){callbacks&&(callbacks.sharenativeShare=e)},set_native_callback:function(e,a){callbacks&&(callbacks[e]=a)},set_share:function(e){var a=this,t=e.link||e.url,n={stoken:localStorage.mmToken,set:"wechat"};localStorage.user&&(t=a.addUrlPara("suid",JSON.parse(localStorage.user).userId,t),n.suid=JSON.parse(localStorage.user).userId),localStorage.uuid&&(n.suuid=localStorage.uuid,t=a.addUrlPara("suuid",localStorage.uuid)),localStorage.uuid2&&(n.suuid2=localStorage.uuid2,t=a.addUrlPara("suuid2",localStorage.uuid2)),n.sell=t,a.signature(null,function(){wx.ready(function(){wx.onMenuShareTimeline({title:e.title,link:t,imgUrl:e.imgUrl||e.image,trigger:function(){},success:function(){n.set="activity_moment",_maq&&_maq.push(["_trackEvent","app_share",n]),vue.appShareCall&&vue.appShareCall({code:1,bshareId:e.bshareId||""})},cancel:function(){},fail:function(){}}),wx.onMenuShareAppMessage({title:e.title,desc:e.desc||e.text,link:t,imgUrl:e.imgUrl||e.image,trigger:function(){},success:function(){n.set="activity_friends",_maq&&_maq.push(["_trackEvent","app_share",n]),vue.appShareCall&&vue.appShareCall({code:1,bshareId:e.bshareId||""})},cancel:function(){},fail:function(){}})})},e.success)},appShareCall:function(e){1==e.code&&e.bshareId&&(localStorage.setItem(e.bshareId,!0),$(".benefitsBeforeImg").addClass("hide"),$(".benefitsAfterImg").addClass("hide"),$(".benefits-type[data-status='1']").find(".benefitsBeforeImg").addClass("hide"),$(".benefits-type[data-status='1']").find(".benefitsAfterImg").removeClass("hide"))},app_share:function(e){window.callByJS&&window.callByJS({domain:"share",action:"share",param:e,callback:function(e){vue.appShareCall(e)}})},app_login:function(e,a){e=e||{},e.source&&(e.channel=e.source),window.callByJS&&window.callByJS({domain:"user",action:"login",param:e,callback:function(e){e&&e.data&&e.data.token&&(localStorage.mmToken=e.data.token),a&&a(e)}})},userInfoCall:function(e){e&&e.data&&e.data.token&&(localStorage.mmToken=e.data.token)},app_userinfo:function(){localStorage.removeItem("mmToken"),window.callByJS&&window.callByJS({domain:"user",action:"userinfo",callback:function(e){vue.userInfoCall(e)}})},app_setShare:function(e){window.callByJS&&window.callByJS({domain:"share",action:"setShareInfo",param:e,callback:function(e){$(".benefits-type").length&&(e.bshareId=$(".benefits-type[data-status=1]").data("id"))}})},isLogin:function(){},getUuid:function(){for(var e=[],a="0123456789abcdef",t=0;36>t;t++)e[t]=a.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=a.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var n=e.join("");return n},created:function(){var e=this;console.log(this),$(".benefits-type").length&&(share_obj.bshareId=$(".benefits-type[data-status=1]").data("id")),vue.isApp()&&e.app_userinfo(),e.getSearch("s")&&e.toAppH5View(),localStorage.uuid||(localStorage.uuid=this.getUuid()),this.getSearch("suuid")&&(_maq&&_maq.push(["_trackEvent","open_share",{suuid2:this.getSearch("suuid"),suuid:localStorage.uuid,sell:location.href,spathname:location.pathname,set:this.getSearch("set"),suid:this.getSearch("suid")}]),localStorage.uuid2=this.getSearch("suuid")),setTimeout(function(){e.app_setShare(share_obj),initLinkEvent(e)},50),this.set_share(share_obj),this.native_share(function(e){e.bshareId=share_obj.bshareId,1==e.code?vue.appShareCall(e):console.log(e.code)}),console.log(callbacks)}};vue.created(),!function(e){$(".benefits-type").length&&$(".benefits-type").each(function(a,t){var n=$(t);n.find(".benefitsBeforeImg").click(function(){_maq.push(["_trackEvent","hide-reward",{}]);var a=$(this).parents(".benefits-type").data("id");appVer.iosVer()||appVer.androidVer()||appVer.iosAlias()?(setTimeout(function(){$(".benefitsBeforeImg").addClass("hide"),$(".benefitsAfterImg").addClass("hide"),n.find(".benefitsBeforeImg").addClass("hide"),n.find(".benefitsAfterImg").removeClass("hide"),localStorage.setItem(a,!0)},8e3),e.callByJS&&e.callByJS({domain:"share",action:"share",param:share_obj,callback:function(e){1==e.code&&($(".benefitsBeforeImg").addClass("hide"),$(".benefitsAfterImg").addClass("hide"),n.find(".benefitsBeforeImg").addClass("hide"),n.find(".benefitsAfterImg").removeClass("hide"),localStorage.setItem(a,!0))}})):location.href=appVer.iosVer()||appVer.iosAlias()?"https://itunes.apple.com/cn/app/memebox-mei-mei-xiang/id960677490?mt=8":appVer.androidVer()?"http://pkg-cn1001.memebox.com/android/app/app-memebox_upgrade.apk":"http://a.app.qq.com/o/simple.jsp?pkgname=com.memebox.cn.android&ckey=CK1334853810944"})}),e.onload=function(){$(".groupImg").each(function(){var e=$(this).siblings("li").eq(0),a=$(e).innerHeight()-1,t={height:a};$(this).css(t),$(this).find(".groupImg-link").show()})};var a="";$(".product").each(function(e,t){a+=a?","+$(t).data("id"):$(t).data("id")}),$(".top-anchor.map-link").click(function(){var e=$(this).data("anchor"),a=$(".anchor-ele[name="+e+"]"),t=a.position().top,n=jQuery("html, body");n.scrollTop(t||0)}),$(".link-popup").click(function(){var e=$(this).data("img"),a=$(this).data("url"),t=$(this).data("type"),n=document.createElement("div"),i=document.createElement("a"),o=document.createElement("img"),r=document.createElement("span"),s=document.createElement("div");i.href="url"===t?a:"#"+a,i.setAttribute("data-anchor",a),o.src=e,i.appendChild(o),n.className="maskPopUp",n.appendChild(s),n.appendChild(i),n.appendChild(r),document.body.appendChild(n)}),$("body").on("touchend",".maskPopUp",function(e){if(e.target&&("DIV"===e.target.nodeName||"SPAN"===e.target.nodeName||"IMG"===e.target.nodeName))var a=setTimeout(function(){$(".maskPopUp").remove(),a=null},0)}),a&&$.ajax({url:$("body").data("pis")+"/global/price",type:"get",dataType:"json",traditional:!0,data:{productIds:a},success:function(e){for(var a=e.data,t=0;t<a.length;t++){var n=$(".product[data-id="+a[t].productId+"]");if(appVer.androidVer()>=400||appVer.iosVer()>=400||appVer.iosAlias()>=400){var i={domain:"product",action:"detail",data:{productId:a[t].productId,url:location.href}},o="memebox://"+encodeURIComponent(JSON.stringify(i));n.find("a").each(function(e,a){$(a).attr("href",o)})}parseInt(a[t].stockStatus)||n.append("<div class='stock-over'>抢光了</div>"),n.hasClass("friday")?(n.find(".pro-shop em span").html(parseInt(a[t].price)),n.find(".pro-shop del span").html(parseInt(a[t].originPrice)),n.find(".pro-shop strong span").html(parseInt(a[t].specialPrice))):(n.find(".pro-shop em").html(a[t].price),n.find(".pro-shop del").html("原价:"+a[t].originPrice))}}}),$(".img-con").length&&$(".img-con").each(function(e,a){var t=$(a).data("fromtime"),n=$(a).data("totime"),i=$("body").data("now");t&&n&&(moment(i).diff(moment(t))<0||moment(i).diff(moment(n))>0)&&$(a).remove()})}(window);